<div class="fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-80 transition-opacity" aria-hidden="true"></div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        
        <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <form hx-post="/admin/dashboard/services{% if service %}/{{ service.id }}{% endif %}" 
                  hx-target="#main-content"
                  hx-swap="innerHTML"
                  hx-on::after-request="
                    if(event.detail.successful) {
                        showToast('Service {% if service %}updated{% else %}created{% endif %} successfully!', 'success');
                        document.getElementById('modal-container').innerHTML='';
                    } else {
                        showToast('Failed to {% if service %}update{% else %}create{% endif %} service. Please try again.', 'error');
                    }
                  ">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100" id="modal-title">
                                {% if service %}Edit Service{% else %}Add New Service{% endif %}
                            </h3>
                            
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Name</label>
                                    <input type="text" 
                                           name="name" 
                                           id="name" 
                                           value="{% if service %}{{ service.name }}{% endif %}"
                                           required
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                </div>

                                <div>
                                    <label for="slug" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Slug</label>
                                    <input type="text" 
                                           name="slug" 
                                           id="slug" 
                                           value="{% if service %}{{ service.slug }}{% endif %}"
                                           required
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                </div>

                                <div>
                                    <label for="category" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Category</label>
                                    <select name="category" 
                                            id="category" 
                                            required
                                            class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                        <option value="">Select a category</option>
                                        <option value="llm" {% if service and service.category == 'llm' %}selected{% endif %}>LLM</option>
                                        <option value="embedding" {% if service and service.category == 'embedding' %}selected{% endif %}>Embedding</option>
                                        <option value="web_search" {% if service and service.category == 'web_search' %}selected{% endif %}>Web Search</option>
                                        <option value="web_scraper" {% if service and service.category == 'web_scraper' %}selected{% endif %}>Web Scraper</option>
                                    </select>
                                </div>

                                <div>
                                    <label for="provider" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Provider</label>
                                    <input type="text" 
                                           name="provider" 
                                           id="provider" 
                                           value="{% if service %}{{ service.provider }}{% endif %}"
                                           required
                                           class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                </div>

                                <div>
                                    <label for="default_config" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Default Config (JSON)</label>
                                    <textarea name="default_config" 
                                              id="default_config" 
                                              rows="4"
                                              class="mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">{% if service and service.default_config %}{{ service.default_config | tojson }}{% endif %}</textarea>
                                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Optional: JSON configuration object</p>
                                </div>

                                <div class="flex items-center">
                                    <input type="checkbox" 
                                           name="is_active" 
                                           id="is_active" 
                                           {% if not service or service.is_active %}checked{% endif %}
                                           class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 dark:border-gray-600 rounded">
                                    <label for="is_active" class="ml-2 block text-sm text-gray-900 dark:text-gray-100">
                                        Active
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="submit" 
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                        {% if service %}Update{% else %}Create{% endif %}
                    </button>
                    <button type="button" 
                            onclick="document.getElementById('modal-container').innerHTML=''"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
